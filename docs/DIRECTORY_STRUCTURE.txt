NoIPCA Directory Structure (Current - After Refactoring)
===========================================================

NoIPCA/
├── Core Workflow Scripts (5 files)
│   ├── main.py                          # Master orchestrator (loops, logs to logs/)
│   ├── generate_panel.py                # Unified panel generator
│   ├── calculate_moments.py             # SDF moments computation
│   ├── run_fama.py                      # Fama-French & Fama-MacBeth
│   └── run_dkkm.py                      # DKKM factors
│
├── Utility Scripts (2 files)
│   ├── view_pickle.py                   # Inspect pickle file contents
│   └── test_randomized_ridge.py         # Test/benchmark ridge regression
│
├── Configuration (1 file)
│   └── config.py                        # Central configuration (all model parameters)
│
├── Analysis (1 file)
│   └── analysis.py                      # Results visualization
│
├── Package (1 file)
│   └── __init__.py
│
├── utils_bgn/ ← BGN MODEL SUBDIRECTORY (self-contained)
│   ├── __init__.py                      # Package init
│   ├── README.md                        # BGN model documentation
│   ├── panel_functions_bgn.py           # Panel generation
│   ├── sdf_compute_bgn.py               # SDF computation
│   ├── loadings_compute_bgn.py          # Factor loadings
│   ├── vasicek.py                       # Vasicek interest rate model
│   └── BGN_solfiles/                    # Pre-computed solutions
│       └── Jstar.csv                    # Bond pricing lookup table
│
├── utils_kp14/ ← KP14 MODEL SUBDIRECTORY (self-contained)
│   ├── __init__.py                      # Package init
│   ├── README.md                        # KP14 model documentation
│   ├── panel_functions_kp14.py          # Panel generation
│   ├── sdf_compute_kp14.py              # SDF computation
│   ├── loadings_compute_kp14.py         # Factor loadings
│   └── KP14_solfiles/                   # Pre-computed solutions
│       ├── G_func.csv                   # G function estimates
│       └── integ_results.npz            # Integration results
│
├── utils_gs21/ ← GS21 MODEL SUBDIRECTORY (self-contained)
│   ├── __init__.py                      # Package init
│   ├── README.md                        # GS21 model documentation
│   ├── panel_functions_gs21.py          # Panel generation
│   ├── sdf_compute_gs21.py              # SDF computation
│   ├── loadings_compute_gs21.py         # Factor loadings
│   └── GS21_solfiles/                   # Pre-computed solutions
│       ├── zgrid.csv, xgrid.csv, igrid.csv, bgrid.csv
│       ├── z_cut_up.csv, z_cut_down.csv
│       ├── i_cut_up.csv, i_cut_down.csv
│       ├── Q_I.csv, Q_0.csv
│       ├── P_up.csv, P_down.csv
│       ├── PI_up.csv, PI_down.csv
│       ├── P0_up.csv, P0_down.csv
│       └── b_refin_0.csv, b_refin_I.csv
│
├── utils_factors/ ← ALL UTILITIES (consolidated)
│   ├── __init__.py                      # Package init
│   ├── factor_utils.py                  # Shared utilities (loading, preparing, saving)
│   ├── factor_utils_numba.py            # Numba-accelerated factor utilities
│   ├── ridge_utils.py                   # Ridge regression (standard & randomized SVD)
│   ├── dkkm_functions.py                # DKKM factor computation
│   ├── dkkm_functions_numba.py          # Numba-accelerated DKKM functions
│   ├── fama_functions.py                # Fama-French & Fama-MacBeth factors
│   └── portfolio_stats.py               # Portfolio statistics computation
│
├── tests/ (5 test files + README)
│   ├── README.md                        # Test documentation
│   ├── test_numba_acceleration.py       # Performance benchmarks
│   ├── test_numba_integration.py        # Numba integration tests
│   ├── test_ridge_integration.py        # Ridge regression tests
│   ├── test_penalty_scaling.py          # Penalty scaling validation
│   └── test_validation.py               # General validation
│
└── docs/ (6 files) ← ALL DOCUMENTATION
    ├── INDEX.md                         # Documentation index
    ├── README.md                        # Main documentation
    ├── DIRECTORY_STRUCTURE.txt          # This file - complete directory structure
    ├── CHANGES.md                       # Consolidated changes from original codebase
    ├── WORKFLOW_GUIDE.md                # Workflow instructions
    └── ACCELERATION.md                  # Performance optimization guide

Total Files:
- Main directory: 10 Python files (__init__.py, main.py, generate_panel.py,
  calculate_moments.py, run_fama.py, run_dkkm.py, analysis.py, config.py,
  view_pickle.py, test_randomized_ridge.py)
- Model subdirectories: 16 Python files + 21 solution files
- Factor utilities: 8 files (all utilities consolidated in utils_factors/)
- Test directory: 6 files (5 tests + README)
- Documentation: 6 files (all in docs/)

Import Structure:
=================

Main workflow scripts import model-specific code via:
  from utils_bgn import panel_functions_bgn as panel_module
  from utils_kp14 import sdf_compute_kp14 as sdf_module
  from utils_gs21 import loadings_compute_gs21

Main workflow scripts import utilities via:
  from utils_factors import factor_utils
  from utils_factors import fama_functions as fama
  from utils_factors import dkkm_functions as dkkm
  from utils_factors import ridge_utils

Within utils_factors/ subdirectory, relative imports are used:
  from .ridge_utils import ridge_regression_fast
  from .factor_utils import rank_standardize
  from .factor_utils_numba import rank_standardize  # Numba-accelerated

Within each model subdirectory, relative imports are used:
  from .vasicek import *
  from .sdf_compute_bgn import *
  from . import panel_functions_bgn as bgn

Solution files are accessed using module-relative paths:
  _SOLFILES_DIR = os.path.join(os.path.dirname(__file__), 'GS21_solfiles')
  data = pd.read_csv(os.path.join(_SOLFILES_DIR, 'zgrid.csv'))

Organization Benefits:
=====================
✅ Clean main directory (10 core .py files)
✅ Model-specific code fully isolated in subdirectories
✅ All utilities consolidated in utils_factors/ (no utils/ directory)
✅ Each model subdirectory is completely self-contained
✅ Solution files co-located with the code that uses them
✅ Clear separation: core workflow, models, utilities, tests, docs
✅ Modular structure - easy to add new models
✅ Professional Python package layout
✅ No circular import issues
✅ Module-relative paths work from any working directory
✅ Ridge regression automatically optimized (randomized SVD for D>1000)
✅ Numba acceleration automatically enabled when available

Key Changes from Original:
==========================
1. Removed utils/ directory - all utilities moved to utils_factors/
2. Consolidated ridge regression utilities into ridge_utils.py
3. Moved rank_standardize and standardize_columns to factor_utils.py
4. Created factor_utils_numba.py for Numba-accelerated versions
5. Added test_randomized_ridge.py for ridge regression testing
6. Consolidated acceleration docs into single ACCELERATION.md
7. Automatic optimization: randomized SVD for D>1000, Numba when available
